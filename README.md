<div align="center">
  <table border="0" cellpadding="0" cellspacing="0" style="border-collapse: collapse; border: 1px solid #ddd; padding: 10px; border-radius: 5px;">
    <tr>
      <td style="padding-right: 10px;"><img src="logo.svg" alt="Wazuh" height="36"></td>
      <td style="padding: 0 10px; font-size: 24px; vertical-align: middle;">&</td>
      <td style="padding-left: 10px;"><img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODciIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCA4NyAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik00Ny45ODU1IDQuOEM0Ny45ODU1IDcuNDUwOTggNDUuODM2NSA5LjYgNDMuMTg1NSA5LjZDNDAuOTQ5IDkuNiAzOS4wNjk2IDguMDcwMyAzOC41MzY4IDZIMzEuODM1MkMzMC42NjIgNiAyOS42NjA3IDYuODQ4MjIgMjkuNDY3OCA4LjAwNTQ0TDI5LjI3MDYgOS4xODkxMkMyOS4wODMyIDEwLjMxMyAyOC41MTQ3IDExLjI5MTEgMjcuNzEwOCAxMkMyOC41MTQ3IDEyLjcwODkgMjkuMDgzMiAxMy42ODcgMjkuMjcwNiAxNC44MTA5TDI5LjQ2NzggMTUuOTk0NkMyOS42NjA3IDE3LjE1MTggMzAuNjYyIDE4IDMxLjgzNTIgMThIMzMuNzM2OEMzNC4yNjk2IDE1LjkyOTcgMzYuMTQ5IDE0LjQgMzguMzg1NSAxNC40QzQxLjAzNjUgMTQuNCA0My4xODU1IDE2LjU0OSA0My4xODU1IDE5LjJDNDMuMTg1NSAyMS44NTEgNDEuMDM2NSAyNCAzOC4zODU1IDI0QzM2LjE0OSAyNCAzNC4yNjk2IDIyLjQ3MDMgMzMuNzM2OCAyMC40SDMxLjgzNTJDMjkuNDg4OCAyMC40IDI3LjQ4NjMgMTguNzAzNiAyNy4xMDA1IDE2LjM4OTFMMjYuOTAzMiAxNS4yMDU0QzI2LjcxMDQgMTQuMDQ4MiAyNS43MDkxIDEzLjIgMjQuNTM1OSAxMy4ySDIyLjU3ODJDMjEuOTc5IDE1LjE2ODEgMjAuMTQ5NSAxNi42IDE3Ljk4NTUgMTYuNkMxNS44MjE2IDE2LjYgMTMuOTkyMSAxNS4xNjgxIDEzLjM5MjkgMTMuMkgxMC41NzgyQzkuOTc5MDEgMTUuMTY4MSA4LjE0OTQ5IDE2LjYgNS45ODU1NCAxNi42QzMuMzM0NTggMTYuNiAxLjE4NTU1IDE0LjQ1MDkgMS4xODU1NSAxMS44QzEuMTg1NTUgOS4xNDkwNCAzLjMzNDU4IDcuMDAwMDIgNS45ODU1NCA3LjAwMDAyQzguMjkzNjEgNy4wMDAwMiAxMC4yMjEyIDguNjI5MDIgMTAuNjgxMiAxMC44SDEzLjI4OTlDMTMuNzQ5OSA4LjYyOTAyIDE1LjY3NzUgNy4wMDAwMiAxNy45ODU1IDcuMDAwMDJDMjAuMjkzNiA3LjAwMDAyIDIyLjIyMTIgOC42MjkwMiAyMi42ODEyIDEwLjhIMjQuNTM1OUMyNS43MDkxIDEwLjggMjYuNzEwNCA5Ljk1MTc4IDI2LjkwMzIgOC43OTQ1NkwyNy4xMDA1IDcuNjEwODhDMjcuNDg2MyA1LjI5NjM4IDI5LjQ4ODggMy42IDMxLjgzNTIgMy42SDM4LjUzNjhDMzkuMDY5NiAxLjUyOTczIDQwLjk0OSAwIDQzLjE4NTUgMEM0NS44MzY1IDAgNDcuOTg1NSAyLjE0OTAzIDQ3Ljk4NTUgNC44Wk00NS41ODU1IDQuOEM0NS41ODU1IDYuMTI1NDYgNDQuNTExIDcuMiA0My4xODU1IDcuMkM0MS44NjAxIDcuMiA0MC43ODU1IDYuMTI1NDYgNDAuNzg1NSA0LjhDNDAuNzg1NSAzLjQ3NDUyIDQxLjg2MDEgMi40IDQzLjE4NTUgMi40QzQ0LjUxMSAyLjQgNDUuNTg1NSAzLjQ3NDUyIDQ1LjU4NTUgNC44Wk01Ljk4NTU0IDE0LjJDNy4zMTEwNSAxNC4yIDguMzg1NTMgMTMuMTI1NSA4LjM4NTUzIDExLjhDOC4zODU1MyAxMC40NzQ1IDcuMzExMDUgOS40MDAwMiA1Ljk4NTU0IDkuNDAwMDJDNC42NjAwNiA5LjQwMDAyIDMuNTg1NTQgMTAuNDc0NSAzLjU4NTU0IDExLjhDMy41ODU1NCAxMy4xMjU1IDQuNjYwMDYgMTQuMiA1Ljk4NTU0IDE0LjJaTTE3Ljk4NTUgMTQuMkMxOS4zMTEgMTQuMiAyMC4zODU1IDEzLjEyNTUgMjAuMzg1NSAxMS44QzIwLjM4NTUgMTAuNDc0NSAxOS4zMTEgOS40MDAwMiAxNy45ODU1IDkuNDAwMDJDMTYuNjYwMSA5LjQwMDAyIDE1LjU4NTUgMTAuNDc0NSAxNS41ODU1IDExLjhDMTUuNTg1NSAxMy4xMjU1IDE2LjY2MDEgMTQuMiAxNy45ODU1IDE0LjJaTTM4LjM4NTUgMjEuNkMzOS43MTEgMjEuNiA0MC43ODU1IDIwLjUyNTUgNDAuNzg1NSAxOS4yQzQwLjc4NTUgMTcuODc0NSAzOS43MTEgMTYuOCAzOC4zODU1IDE2LjhDMzcuMDYwMSAxNi44IDM1Ljk4NTUgMTcuODc0NSAzNS45ODU1IDE5LjJDMzUuOTg1NSAyMC41MjU1IDM3LjA2MDEgMjEuNiAzOC4zODU1IDIxLjZaIiBmaWxsPSIjRUE0QjcxIj48L3BhdGg+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNNzEuNzM4MSAxMS40MDI3VjExLjI4NTJDNzIuNTk5NyAxMC44NTQ0IDczLjQ2MTMgMTAuMTEwNCA3My40NjEzIDguNjQyMDZDNzMuNDYxMyA2LjUyNzU0IDcxLjcxODMgNS4yNTQ4OCA2OS4zMTA1IDUuMjU0ODhDNjYuODQzMyA1LjI1NDg4IDY1LjA4MTEgNi42MDU4NCA2NS4wODExIDguNjgxMThDNjUuMDgxMSAxMC4wOTA5IDY1LjkwMzcgMTAuODU0NCA2Ni44MDQzIDExLjI4NTJWMTEuNDAyN0M2NS44MDU5IDExLjc1NTEgNjQuNjExMyAxMi44MTI0IDY0LjYxMTMgMTQuNTc0NEM2NC42MTEzIDE2LjcwODYgNjYuMzczNSAxOC4xOTY2IDY5LjI5MDcgMTguMTk2NkM3Mi4yMDc5IDE4LjE5NjYgNzMuOTExMyAxNi43MDg2IDczLjkxMTMgMTQuNTc0NEM3My45MTEzIDEyLjgxMjQgNzIuNzM2NSAxMS43NzQ3IDcxLjczODEgMTEuNDAyN1pNNjkuMjkwNyA3LjA1NjE0QzcwLjI2OTkgNy4wNTYxNCA3MC45OTQxIDcuNjgyNjYgNzAuOTk0MSA4LjczOTkyQzcwLjk5NDEgOS43OTcxOCA3MC4yNTAxIDEwLjQyMzggNjkuMjkwNyAxMC40MjM4QzY4LjMzMTMgMTAuNDIzOCA2Ny41Mjg1IDkuNzk3MTggNjcuNTI4NSA4LjczOTkyQzY3LjUyODUgNy42NjMxIDY4LjI5MjMgNy4wNTYxNCA2OS4yOTA3IDcuMDU2MTRaTTY5LjI5MDcgMTYuMzE3QzY4LjE1NDkgMTYuMzE3IDY3LjIzNTEgMTUuNTkyNiA2Ny4yMzUxIDE0LjM1OTFDNjcuMjM1MSAxMy4yNDMxIDY3Ljk5ODMgMTIuNDAxMiA2OS4yNzA5IDEyLjQwMTJDNzAuNTI0MyAxMi40MDEyIDcxLjI4ODEgMTMuMjIzNSA3MS4yODgxIDE0LjM5ODNDNzEuMjg4MSAxNS41OTI2IDcwLjQwNjcgMTYuMzE3IDY5LjI5MDcgMTYuMzE3Wk01Mi43ODcxIDE4LjAwMDRINTUuMjkzM1YxMi42OTQ1QzU1LjI5MzMgMTAuOTUyIDU2LjM1MDUgMTAuMTg4NCA1Ny41NDQ4IDEwLjE4ODRDNTguNzE5NSAxMC4xODg0IDU5LjYzOTggMTAuOTcxNSA1OS42Mzk4IDEyLjU3N1YxOC4wMDA0SDYyLjE0NTZWMTIuMDY4QzYyLjE0NTYgOS41MDMxNCA2MC42NTc2IDguMDE1MTQgNTguMzI4IDguMDE1MTRDNTYuODU5NiA4LjAxNTE0IDU2LjAzNzIgOC42MDI0OCA1NS40NDk4IDkuMzY2MDRINTUuMjkzM0w1NS4wNzc5IDguMjEwOTJINTIuNzg3MVYxOC4wMDA0Wk03OC45NjMyIDE4LjAwMDRINzYuNDU3VjguMjEwOTJINzguNzQ3OEw3OC45NjMyIDkuMzY2MDRINzkuMTE5OEM3OS43MDcyIDguNjAyNDggODAuNTI5OCA4LjAxNTE0IDgxLjk5OCA4LjAxNTE0Qzg0LjMyNzggOC4wMTUxNCA4NS44MTU4IDkuNTAzMTQgODUuODE1OCAxMi4wNjhWMTguMDAwNEg4My4zMDk2VjEyLjU3N0M4My4zMDk2IDEwLjk3MTUgODIuMzg5OCAxMC4xODg0IDgxLjIxNSAxMC4xODg0QzgwLjAyMDQgMTAuMTg4NCA3OC45NjMyIDEwLjk1MiA3OC45NjMyIDEyLjY5NDVWMTguMDAwNFoiIGZpbGw9IiMwNDA1MDYiPjwvcGF0aD4KPC9zdmc+Cg==" alt="n8n" height="24"></td>
    </tr>
  </table>
</div>

# üõ°Ô∏è Open Source SOAR: Fortigate Threat Intelligence with Wazuh & n8n

![Wazuh](https://img.shields.io/badge/Wazuh-4.x-blue?style=for-the-badge&logo=wazuh)
![n8n](https://img.shields.io/badge/n8n-Workflow-orange?style=for-the-badge&logo=n8n)
![Fortigate](https://img.shields.io/badge/Fortinet-Fortigate-red?style=for-the-badge&logo=fortinet)

## üìñ About The Project

This project provides a simple, open-source SOAR (Security Orchestration, Automation, and Response) architecture using **Fortigate Firewall**, **Wazuh SIEM**, and **n8n**.

It automatically fetches and analyzes malicious connections blocked by the Fortigate firewall. The n8n workflow periodically queries Wazuh for alerts related to Fortigate's deny actions (specifically `Rule ID: 81619`), enriches the data with threat intelligence from AbuseIPDB, and sends detailed alerts via Telegram.

### üöÄ Architecture Flow

1.  **Detection & Logging:** The Fortigate Firewall blocks a suspicious connection, and the log is forwarded to the Wazuh Manager.
2.  **Alert Generation:** Wazuh generates an alert based on the standard Fortigate rule `81619`.
3.  **Scheduled Fetch (n8n Workflow):**
    *   An n8n workflow runs on a schedule (e.g., every minute).
    *   It authenticates to the Wazuh API and queries for new alerts matching `rule.id: 81619`.
4.  **Enrichment & Alerting (n8n Workflow):**
    *   The workflow extracts the source and destination IP addresses from the Wazuh alert.
    *   It filters out private and whitelisted IP addresses.
    *   Public IPs are checked against the **AbuseIPDB** API for reputation.
    *   If an IP's abuse score is above a defined threshold (e.g., 50), a detailed intelligence report is sent to a security analyst via **Telegram**.
    *   Additionally, the workflow can detect if the log contains "nmap" and send a separate, immediate notification.

---

## ‚öôÔ∏è Setup and Configuration

Follow these steps to get the SOAR workflow running.

### Step 1: Import and Configure the n8n Workflow

1.  **Import Workflow:** Import the `n8n/workflow.json` file into your n8n instance.
2.  **Configure Credentials & Variables:** The workflow requires several pieces of information to be configured directly in the n8n nodes.

    *   **Wazuh Credentials:**
        *   In the **"IMPORTANT FIRST STEP!"** node, replace `YOURWAZUHUSERNAME` and `YOURWAZUHPASSWORD` with your actual Wazuh API credentials.
        *   In the **"HTTP Request"** node, update the URL `https://YOUR_WAZUH_HOST:9200` to point to your Wazuh server.

    *   **AbuseIPDB API Key:**
        *   In the **"AbuseIPDB Check"** node, go to the "Header" section and replace the placeholder API key with your own AbuseIPDB API key.
        > **‚ö†Ô∏è Security Warning:** The API key is hardcoded in the workflow. For better security, it is highly recommended to store the key as a credential or an environment variable in n8n.

    *   **Telegram Configuration:**
        *   In the **"Send a text message"** and **"Send a text message1"** nodes, replace `YOUR_TELEGRAM_CHAT_ID` with the target Telegram chat ID.
        *   Create a "Telegram Bot API" credential in n8n and select it in both Telegram nodes.

### Step 2: Activate the Workflow

After configuring all the credentials and variables, **activate the workflow** in n8n. It will start running according to the schedule defined in the "Schedule Trigger" node.